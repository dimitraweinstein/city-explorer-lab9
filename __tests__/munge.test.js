const {  mungeWeatherResponse } = require('../lib/munge.js');

require('dotenv').config();


const fakeRequest = require('supertest');
const app = require('../lib/app');
// const client = require('../lib/client');

describe('munge functions', () =>
{

  test('returns weather data', async () =>
  {
    const expectation = [
      { 'forecast': 'Few clouds', 'time': 'Thursday, June 24, 2021', },
      { 'forecast': 'Broken clouds', 'time': 'Friday, June 25, 2021', },
      { 'forecast': 'Broken clouds', 'time': 'Saturday, June 26, 2021', },
      { 'forecast': 'Few clouds', 'time': 'Sunday, June 27, 2021', },
      { 'forecast': 'Broken clouds', 'time': 'Monday, June 28, 2021', },
      { 'forecast': 'Broken clouds', 'time': 'Tuesday, June 29, 2021', },
      { 'forecast': 'Overcast clouds', 'time': 'Wednesday, June 30, 2021', },
      { 'forecast': 'Thunderstorm with rain', 'time': 'Thursday, July 1, 2021', },
      { 'forecast': 'Broken clouds', 'time': 'Friday, July 2, 2021', },
      { 'forecast': 'Overcast clouds', 'time': 'Saturday, July 3, 2021', },
      { 'forecast': 'Moderate rain', 'time': 'Sunday, July 4, 2021', },
      { 'forecast': 'Thunderstorm with rain', 'time': 'Monday, July 5, 2021', },
      { 'forecast': 'Overcast clouds', 'time': 'Tuesday, July 6, 2021', },
      { 'forecast': 'Overcast clouds', 'time': 'Wednesday, July 7, 2021', },
      { 'forecast': 'Broken clouds', 'time': 'Thursday, July 8, 2021', },
      { 'forecast': 'Scattered clouds', 'time': 'Friday, July 9, 2021', },
    ];
    
    const input = {
      'data': [
        {
          'moonrise_ts': 1624669935,
          'wind_cdir': 'E',
          'rh': 62,
          'pres': 988.521,
          'high_temp': 28.2,
          'sunset_ts': 1624668723,
          'ozone': 305.76,
          'moon_phase': 0.956391,
          'wind_gust_spd': 10.0938,
          'snow_depth': 0,
          'clouds': 7,
          'ts': 1624593660,
          'sunrise_ts': 1624616964,
          'app_min_temp': 19.5,
          'wind_spd': 2.87362,
          'pop': 0,
          'wind_cdir_full': 'east',
          'slp': 1020.25,
          'moon_phase_lunation': 0.53,
          'valid_date': '2021-06-25',
          'app_max_temp': 28.9,
          'vis': 24.096,
          'dewpt': 16.1,
          'snow': 0,
          'uv': 10.6418,
          'weather': {
            'icon': 'c02d',
            'code': 801,
            'description': 'Few clouds'
          },
          'wind_dir': 98,
          'max_dhi': null,
          'clouds_hi': 1,
          'precip': 0,
          'low_temp': 19.7,
          'max_temp': 28.3,
          'moonset_ts': 1624623384,
          'datetime': '2021-06-25',
          'temp': 24.1,
          'min_temp': 19.5,
          'clouds_mid': 0,
          'clouds_low': 7
        },
        {
          'moonrise_ts': 1624760031,
          'wind_cdir': 'E',
          'rh': 77,
          'pres': 987.979,
          'high_temp': 28.4,
          'sunset_ts': 1624755128,
          'ozone': 295.396,
          'moon_phase': 0.894502,
          'wind_gust_spd': 8.59375,
          'snow_depth': 0,
          'clouds': 53,
          'ts': 1624680060,
          'sunrise_ts': 1624703383,
          'app_min_temp': 21.6,
          'wind_spd': 2.29751,
          'pop': 20,
          'wind_cdir_full': 'east',
          'slp': 1019.73,
          'moon_phase_lunation': 0.56,
          'valid_date': '2021-06-26',
          'app_max_temp': 30.9,
          'vis': 24.096,
          'dewpt': 19.4,
          'snow': 0,
          'uv': 5.46652,
          'weather': {
            'icon': 'c03d',
            'code': 803,
            'description': 'Broken clouds'
          },
          'wind_dir': 93,
          'max_dhi': null,
          'clouds_hi': 10,
          'precip': 0.125,
          'low_temp': 21.4,
          'max_temp': 28.4,
          'moonset_ts': 1624713914,
          'datetime': '2021-06-26',
          'temp': 24.1,
          'min_temp': 21.3,
          'clouds_mid': 1,
          'clouds_low': 53
        },
        {
          'moonrise_ts': 1624849559,
          'wind_cdir': 'ESE',
          'rh': 67,
          'pres': 986.896,
          'high_temp': 31.9,
          'sunset_ts': 1624841532,
          'ozone': 295.396,
          'moon_phase': 0.813043,
          'wind_gust_spd': 9.8125,
          'snow_depth': 0,
          'clouds': 55,
          'ts': 1624766460,
          'sunrise_ts': 1624789803,
          'app_min_temp': 20.9,
          'wind_spd': 2.8206,
          'pop': 0,
          'wind_cdir_full': 'east-southeast',
          'slp': 1018.98,
          'moon_phase_lunation': 0.59,
          'valid_date': '2021-06-27',
          'app_max_temp': 32.2,
          'vis': 24.128,
          'dewpt': 18.6,
          'snow': 0,
          'uv': 6.28703,
          'weather': {
            'icon': 'c03d',
            'code': 803,
            'description': 'Broken clouds'
          },
          'wind_dir': 123,
          'max_dhi': null,
          'clouds_hi': 22,
          'precip': 0,
          'low_temp': 20.3,
          'max_temp': 32.1,
          'moonset_ts': 1624804328,
          'datetime': '2021-06-27',
          'temp': 25.8,
          'min_temp': 20.2,
          'clouds_mid': 2,
          'clouds_low': 39
        },
        {
          'moonrise_ts': 1624938558,
          'wind_cdir': 'ESE',
          'rh': 61,
          'pres': 988.167,
          'high_temp': 33.6,
          'sunset_ts': 1624927934,
          'ozone': 306.281,
          'moon_phase': 0.718729,
          'wind_gust_spd': 9.33594,
          'snow_depth': 0,
          'clouds': 19,
          'ts': 1624852860,
          'sunrise_ts': 1624876225,
          'app_min_temp': 20.6,
          'wind_spd': 3.19064,
          'pop': 20,
          'wind_cdir_full': 'east-southeast',
          'slp': 1020.31,
          'moon_phase_lunation': 0.63,
          'valid_date': '2021-06-28',
          'app_max_temp': 33,
          'vis': 24.056,
          'dewpt': 17.4,
          'snow': 0,
          'uv': 9.72894,
          'weather': {
            'icon': 'c02d',
            'code': 801,
            'description': 'Few clouds'
          },
          'wind_dir': 108,
          'max_dhi': null,
          'clouds_hi': 7,
          'precip': 0.0625,
          'low_temp': 20.2,
          'max_temp': 33.6,
          'moonset_ts': 1624894541,
          'datetime': '2021-06-28',
          'temp': 26.5,
          'min_temp': 20.1,
          'clouds_mid': 0,
          'clouds_low': 12
        },
        {
          'moonrise_ts': 1624940738,
          'wind_cdir': 'ESE',
          'rh': 74,
          'pres': 989.361,
          'high_temp': 31.9,
          'sunset_ts': 1625014334,
          'ozone': 320.611,
          'moon_phase': 0.617634,
          'wind_gust_spd': 9.40625,
          'snow_depth': 0,
          'clouds': 68,
          'ts': 1624939260,
          'sunrise_ts': 1624962647,
          'app_min_temp': 21.3,
          'wind_spd': 2.97957,
          'pop': 10,
          'wind_cdir_full': 'east-southeast',
          'slp': 1021.64,
          'moon_phase_lunation': 0.66,
          'valid_date': '2021-06-29',
          'app_max_temp': 32.1,
          'vis': 24.128,
          'dewpt': 19.2,
          'snow': 0,
          'uv': 6.80184,
          'weather': {
            'icon': 'c03d',
            'code': 803,
            'description': 'Broken clouds'
          },
          'wind_dir': 107,
          'max_dhi': null,
          'clouds_hi': 41,
          'precip': 0.3125,
          'low_temp': 20.2,
          'max_temp': 31.4,
          'moonset_ts': 1624984552,
          'datetime': '2021-06-29',
          'temp': 24.6,
          'min_temp': 20.7,
          'clouds_mid': 19,
          'clouds_low': 36
        },
        {
          'moonrise_ts': 1625029024,
          'wind_cdir': 'SE',
          'rh': 73,
          'pres': 987.188,
          'high_temp': 31.8,
          'sunset_ts': 1625100733,
          'ozone': 319.438,
          'moon_phase': 0.51474,
          'wind_gust_spd': 6.69922,
          'snow_depth': 0,
          'clouds': 58,
          'ts': 1625025660,
          'sunrise_ts': 1625049071,
          'app_min_temp': 20.8,
          'wind_spd': 2.16441,
          'pop': 55,
          'wind_cdir_full': 'southeast',
          'slp': 1019.25,
          'moon_phase_lunation': 0.69,
          'valid_date': '2021-06-30',
          'app_max_temp': 32.7,
          'vis': 24.034,
          'dewpt': 19.7,
          'snow': 0,
          'uv': 6.17095,
          'weather': {
            'icon': 'c03d',
            'code': 803,
            'description': 'Broken clouds'
          },
          'wind_dir': 126,
          'max_dhi': null,
          'clouds_hi': 19,
          'precip': 3.5,
          'low_temp': 21.5,
          'max_temp': 32.1,
          'moonset_ts': 1625074406,
          'datetime': '2021-06-30',
          'temp': 25.4,
          'min_temp': 19.9,
          'clouds_mid': 0,
          'clouds_low': 51
        },
        {
          'moonrise_ts': 1625117126,
          'wind_cdir': 'S',
          'rh': 71,
          'pres': 983.562,
          'high_temp': 28.6,
          'sunset_ts': 1625187131,
          'ozone': 312.781,
          'moon_phase': 0.413957,
          'wind_gust_spd': 4.80078,
          'snow_depth': 0,
          'clouds': 75,
          'ts': 1625112060,
          'sunrise_ts': 1625135496,
          'app_min_temp': 22,
          'wind_spd': 2.13731,
          'pop': 45,
          'wind_cdir_full': 'south',
          'slp': 1015.56,
          'moon_phase_lunation': 0.73,
          'valid_date': '2021-07-01',
          'app_max_temp': 33,
          'vis': 22.182,
          'dewpt': 19.8,
          'snow': 0,
          'uv': 3.43087,
          'weather': {
            'icon': 'c04d',
            'code': 804,
            'description': 'Overcast clouds'
          },
          'wind_dir': 172,
          'max_dhi': null,
          'clouds_hi': 66,
          'precip': 2.3125,
          'low_temp': 20.9,
          'max_temp': 33.2,
          'moonset_ts': 1625164165,
          'datetime': '2021-07-01',
          'temp': 26,
          'min_temp': 20.9,
          'clouds_mid': 0,
          'clouds_low': 31
        },
        {
          'moonrise_ts': 1625205133,
          'wind_cdir': 'SW',
          'rh': 80,
          'pres': 983.25,
          'high_temp': 30.5,
          'sunset_ts': 1625273526,
          'ozone': 305.75,
          'moon_phase': 0.318398,
          'wind_gust_spd': 10.4219,
          'snow_depth': 0,
          'clouds': 44,
          'ts': 1625198460,
          'sunrise_ts': 1625221922,
          'app_min_temp': 21.6,
          'wind_spd': 2.19805,
          'pop': 75,
          'wind_cdir_full': 'southwest',
          'slp': 1015.31,
          'moon_phase_lunation': 0.76,
          'valid_date': '2021-07-02',
          'app_max_temp': 31.4,
          'vis': 19.67,
          'dewpt': 21.1,
          'snow': 0,
          'uv': 10.296,
          'weather': {
            'icon': 't02d',
            'code': 201,
            'description': 'Thunderstorm with rain'
          },
          'wind_dir': 220,
          'max_dhi': null,
          'clouds_hi': 32,
          'precip': 7.9375,
          'low_temp': 21,
          'max_temp': 30.7,
          'moonset_ts': 1625253891,
          'datetime': '2021-07-02',
          'temp': 24.9,
          'min_temp': 20.6,
          'clouds_mid': 3,
          'clouds_low': 15
        },
        {
          'moonrise_ts': 1625293126,
          'wind_cdir': 'SW',
          'rh': 71,
          'pres': 984.875,
          'high_temp': 33.4,
          'sunset_ts': 1625359921,
          'ozone': 299.188,
          'moon_phase': 0.230743,
          'wind_gust_spd': 11.3047,
          'snow_depth': 0,
          'clouds': 58,
          'ts': 1625284860,
          'sunrise_ts': 1625308349,
          'app_min_temp': 21.6,
          'wind_spd': 2.80147,
          'pop': 20,
          'wind_cdir_full': 'southwest',
          'slp': 1016.94,
          'moon_phase_lunation': 0.8,
          'valid_date': '2021-07-03',
          'app_max_temp': 31.6,
          'vis': 24.128,
          'dewpt': 19.7,
          'snow': 0,
          'uv': 6.53523,
          'weather': {
            'icon': 'c03d',
            'code': 803,
            'description': 'Broken clouds'
          },
          'wind_dir': 236,
          'max_dhi': null,
          'clouds_hi': 21,
          'precip': 0.125,
          'low_temp': 21.4,
          'max_temp': 30.7,
          'moonset_ts': 1625343632,
          'datetime': '2021-07-03',
          'temp': 25.8,
          'min_temp': 20.5,
          'clouds_mid': 0,
          'clouds_low': 46
        },
        {
          'moonrise_ts': 1625381176,
          'wind_cdir': 'SW',
          'rh': 64,
          'pres': 984.7,
          'high_temp': 32,
          'sunset_ts': 1625446313,
          'ozone': 295.15,
          'moon_phase': 0.153551,
          'wind_gust_spd': 5.01172,
          'snow_depth': 0,
          'clouds': 83,
          'ts': 1625371260,
          'sunrise_ts': 1625394777,
          'app_min_temp': 21.8,
          'wind_spd': 2.00442,
          'pop': 0,
          'wind_cdir_full': 'southwest',
          'slp': 1016.7,
          'moon_phase_lunation': 0.83,
          'valid_date': '2021-07-04',
          'app_max_temp': 33.3,
          'vis': 24.128,
          'dewpt': 17.9,
          'snow': 0,
          'uv': 5.65627,
          'weather': {
            'icon': 'c04d',
            'code': 804,
            'description': 'Overcast clouds'
          },
          'wind_dir': 235,
          'max_dhi': null,
          'clouds_hi': 83,
          'precip': 0,
          'low_temp': 21.1,
          'max_temp': 33.4,
          'moonset_ts': 1625433415,
          'datetime': '2021-07-04',
          'temp': 26,
          'min_temp': 21.1,
          'clouds_mid': 0,
          'clouds_low': 6
        },
        {
          'moonrise_ts': 1625469356,
          'wind_cdir': 'S',
          'rh': 88,
          'pres': 982.75,
          'high_temp': 31.2,
          'sunset_ts': 1625532704,
          'ozone': 288.5,
          'moon_phase': 0.0894298,
          'wind_gust_spd': 5.91406,
          'snow_depth': 0,
          'clouds': 100,
          'ts': 1625457660,
          'sunrise_ts': 1625481206,
          'app_min_temp': 22.9,
          'wind_spd': 1.93839,
          'pop': 80,
          'wind_cdir_full': 'south',
          'slp': 1014.75,
          'moon_phase_lunation': 0.86,
          'valid_date': '2021-07-05',
          'app_max_temp': 26.6,
          'vis': 14.938,
          'dewpt': 21.8,
          'snow': 0,
          'uv': 3.4217,
          'weather': {
            'icon': 'r02d',
            'code': 501,
            'description': 'Moderate rain'
          },
          'wind_dir': 184,
          'max_dhi': null,
          'clouds_hi': 100,
          'precip': 11.8125,
          'low_temp': 21,
          'max_temp': 27.6,
          'moonset_ts': 1625523232,
          'datetime': '2021-07-05',
          'temp': 24,
          'min_temp': 21.5,
          'clouds_mid': 52,
          'clouds_low': 12
        },
        {
          'moonrise_ts': 1625557740,
          'wind_cdir': 'SSW',
          'rh': 69,
          'pres': 984.5,
          'high_temp': 29.4,
          'sunset_ts': 1625619094,
          'ozone': 288.25,
          'moon_phase': 0.0410198,
          'wind_gust_spd': 9.80469,
          'snow_depth': 0,
          'clouds': 94,
          'ts': 1625544060,
          'sunrise_ts': 1625567636,
          'app_min_temp': 22.2,
          'wind_spd': 3.74293,
          'pop': 65,
          'wind_cdir_full': 'south-southwest',
          'slp': 1016.75,
          'moon_phase_lunation': 0.9,
          'valid_date': '2021-07-06',
          'app_max_temp': 32.7,
          'vis': 24.128,
          'dewpt': 19.1,
          'snow': 0,
          'uv': 4.3264,
          'weather': {
            'icon': 't02d',
            'code': 201,
            'description': 'Thunderstorm with rain'
          },
          'wind_dir': 204,
          'max_dhi': null,
          'clouds_hi': 83,
          'precip': 5.25,
          'low_temp': 22.6,
          'max_temp': 32,
          'moonset_ts': 1625613036,
          'datetime': '2021-07-06',
          'temp': 26.8,
          'min_temp': 21,
          'clouds_mid': 56,
          'clouds_low': 61
        },
        {
          'moonrise_ts': 1625646400,
          'wind_cdir': 'NW',
          'rh': 72,
          'pres': 988,
          'high_temp': 32.9,
          'sunset_ts': 1625705482,
          'ozone': 295.75,
          'moon_phase': 0.0107898,
          'wind_gust_spd': 1.7334,
          'snow_depth': 0,
          'clouds': 100,
          'ts': 1625630460,
          'sunrise_ts': 1625654067,
          'app_min_temp': 21.3,
          'wind_spd': 1.17688,
          'pop': 0,
          'wind_cdir_full': 'northwest',
          'slp': 1020.25,
          'moon_phase_lunation': 0.93,
          'valid_date': '2021-07-07',
          'app_max_temp': 28.3,
          'vis': 24.128,
          'dewpt': 18.5,
          'snow': 0,
          'uv': 3.40813,
          'weather': {
            'icon': 'c04d',
            'code': 804,
            'description': 'Overcast clouds'
          },
          'wind_dir': 318,
          'max_dhi': null,
          'clouds_hi': 100,
          'precip': 0,
          'low_temp': 21.5,
          'max_temp': 27.4,
          'moonset_ts': 1625702741,
          'datetime': '2021-07-07',
          'temp': 24,
          'min_temp': 21.1,
          'clouds_mid': 91,
          'clouds_low': 2
        },
        {
          'moonrise_ts': 1625735396,
          'wind_cdir': 'WNW',
          'rh': 64,
          'pres': 986.25,
          'high_temp': 31.1,
          'sunset_ts': 1625791868,
          'ozone': 305.375,
          'moon_phase': 0.0107898,
          'wind_gust_spd': 3.10352,
          'snow_depth': 0,
          'clouds': 92,
          'ts': 1625716860,
          'sunrise_ts': 1625740499,
          'app_min_temp': 22.6,
          'wind_spd': 1.35272,
          'pop': 20,
          'wind_cdir_full': 'west-northwest',
          'slp': 1018.5,
          'moon_phase_lunation': 0.96,
          'valid_date': '2021-07-08',
          'app_max_temp': 32.3,
          'vis': 24.128,
          'dewpt': 18.6,
          'snow': 0,
          'uv': 4.64342,
          'weather': {
            'icon': 'c04d',
            'code': 804,
            'description': 'Overcast clouds'
          },
          'wind_dir': 297,
          'max_dhi': null,
          'clouds_hi': 92,
          'precip': 0.1875,
          'low_temp': 21,
          'max_temp': 31.2,
          'moonset_ts': 1625789141,
          'datetime': '2021-07-08',
          'temp': 26.7,
          'min_temp': 21,
          'clouds_mid': 69,
          'clouds_low': 4
        },
        {
          'moonrise_ts': 1625824755,
          'wind_cdir': 'SW',
          'rh': 76,
          'pres': 986.25,
          'high_temp': 29.3,
          'sunset_ts': 1625878252,
          'ozone': 302.75,
          'moon_phase': 0.000726167,
          'wind_gust_spd': 2.70117,
          'snow_depth': 0,
          'clouds': 58,
          'ts': 1625803260,
          'sunrise_ts': 1625826931,
          'app_min_temp': 21.7,
          'wind_spd': 2.03503,
          'pop': 55,
          'wind_cdir_full': 'southwest',
          'slp': 1018.5,
          'moon_phase_lunation': 1,
          'valid_date': '2021-07-09',
          'app_max_temp': 31,
          'vis': 24.128,
          'dewpt': 20,
          'snow': 0,
          'uv': 7.37953,
          'weather': {
            'icon': 'c03d',
            'code': 803,
            'description': 'Broken clouds'
          },
          'wind_dir': 232,
          'max_dhi': null,
          'clouds_hi': 47,
          'precip': 3.8125,
          'low_temp': 22.1,
          'max_temp': 29.4,
          'moonset_ts': 1625878647,
          'datetime': '2021-07-09',
          'temp': 25.2,
          'min_temp': 21,
          'clouds_mid': 39,
          'clouds_low': 0
        },
        {
          'moonrise_ts': 1625914449,
          'wind_cdir': 'SE',
          'rh': 59,
          'pres': 987.75,
          'high_temp': 32.9,
          'sunset_ts': 1625964635,
          'ozone': 299.75,
          'moon_phase': 0.0120419,
          'wind_gust_spd': 5.21875,
          'snow_depth': 0,
          'clouds': 25,
          'ts': 1625889660,
          'sunrise_ts': 1625913364,
          'app_min_temp': 23,
          'wind_spd': 2.5987,
          'pop': 0,
          'wind_cdir_full': 'southeast',
          'slp': 1020,
          'moon_phase_lunation': 0.03,
          'valid_date': '2021-07-10',
          'app_max_temp': 33,
          'vis': 24.128,
          'dewpt': 17.9,
          'snow': 0,
          'uv': 10.9668,
          'weather': {
            'icon': 'c02d',
            'code': 802,
            'description': 'Scattered clouds'
          },
          'wind_dir': 129,
          'max_dhi': null,
          'clouds_hi': 25,
          'precip': 0,
          'low_temp': 23.4,
          'max_temp': 32.9,
          'moonset_ts': 1625967879,
          'datetime': '2021-07-10',
          'temp': 27.8,
          'min_temp': 22.6,
          'clouds_mid': 2,
          'clouds_low': 0
        }
      ],
      'city_name': 'Fayetteville',
      'lon': '-84.45493',
      'timezone': 'America/New_York',
      'lat': '33.44873',
      'country_code': 'US',
      'state_code': 'GA'
    };
    
    const actual = mungeWeatherResponse(input);

    expect(actual).toEqual(expectation);
  });
});
